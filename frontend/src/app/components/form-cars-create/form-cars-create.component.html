<form [formGroup]="carForm" (ngSubmit)="onSubmit()">
  <div class="set-label-control">
    <label for="brand">Marca</label>
    <select id="brand" formControlName="brand" (change)="getModels()">
      <option selected></option>
      @for (brand of brands(); track $index) {
        <option>{{ brand }}</option>
      }
    </select>
  </div>

  <div class="set-label-control">
    <label for="model">Modelo</label>
    <select id="model" formControlName="model">
      @for (model of models(); track $index) {
        <option value="{{ model }}">{{ model }}</option>
      }
    </select>
  </div>

  <h4>Detalles de los coches</h4>
  <div class="cars-details" formArrayName="details">
    @for (detail of details.controls; track $index; let i = $index) {
      <div class="details-container" [formGroupName]="i">
        <h4>Detalle del coche {{ i + 1 }}</h4>
        <div class="row-details">
          <div class="set-label-control">
            <label for="registrationDate">Fecha de registro</label>
            <input
              type="date"
              id="registrationDate"
              formControlName="registrationDate"
            />
          </div>

          <div class="set-label-control">
            <label for="manufactureYear">Año de fabricación</label>
            <input
              type="number"
              id="manufactureYear"
              formControlName="manufactureYear"
            />
          </div>
        </div>

        <div class="row-details">
          <div class="set-label-control">
            <label for="price">Precio</label>
            <input type="number" id="price" formControlName="price" />
          </div>

          <div class="set-label-control">
            <label for="currency">Moneda</label>
            <select id="currency" formControlName="currency">
              <option value="">Selecciona una moneda</option>
              @for (currency of currencies; track $index) {
                <option>{{ currency }}</option>
              }
            </select>
          </div>
        </div>

        <div class="row-details">
          <div class="set-label-control">
            <label for="licensePlate">Matrícula</label>
            <input
              type="text"
              id="licensePlate"
              formControlName="licensePlate"
            />
          </div>

          <div class="set-label-control">
            <label for="mileage">Kilometraje</label>
            <input type="number" id="mileage" formControlName="mileage" />
          </div>
        </div>

        <div class="row-details">
          <div class="set-label-control">
            <label for="">Disponibilidad</label>
            <input
              type="checkbox"
              id="availability"
              formControlName="availability"
            />
          </div>
        </div>
      </div>
    }
    <div class="buttons">
      <button type="button" appCarButton (click)="addDetails()">
        Añadir nuevo coche
      </button>
      <button type="submit" appCarButton>Guardar</button>
    </div>
  </div>
</form>
